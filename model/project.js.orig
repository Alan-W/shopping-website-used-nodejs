var mongodb = require('./db');
var ObjectID = require('mongodb').ObjectID;
<<<<<<< HEAD
//å®šä¹‰Projectç±
=======
//å®šä¹‰Projectç±»
>>>>>>> origin/ç¬¬ä¸‰æ¬¡åˆå¹¶
function Project(project) {
    this.remarkName = project.remarkName;
    this.wholeMoney= project.money;
    this.lowestMoney= project.lowestMoney;
    this.type = project.type;
    this.province = project.province;
    this.logo = project.logo;
        this.state = 0;
    this.simpleDescription= project.simpleDescription;
        this.state = 0;
    this.background= project.background;
    this.images= project.images;
    this.state= 0
}
//è¾“å‡ºProject
module.exports = Project;
//å­˜å‚¨é¡¹ç›®ä¿¡æ¯
Project.prototype.save = function(callback) {
    var project ={
        remarkName: this.remarkName,
        wholeMoney: this.money,
        lowestMoney: this.lowestMoney,
        type: this.type,
        province: this.province,
        logo: this.logo,
<<<<<<< HEAD
=======
        state: this.state
        
>>>>>>> origin/ç¬¬ä¸‰æ¬¡åˆå¹¶
        simpleDescription: this.simpleDescription,
        background: this.background,
        state: this.state
        
        images: this.images,
        state: this.state
    }
    mongodb.open(function(err, db) {
        if (err) {
            return callback(err)//é”™è¯¯ï¼Œè¿”å›errä¿¡æ¯
        };
        //è¯»å–projectsé›†åˆ
        db.collection('projects', function(err, collection){
            if (err) {
                mongodb.close();//é”™è¯¯ï¼Œå…³é—­æ•°æ®åº“
                return callback(err);//é”™è¯¯ï¼Œè¿”å›errä¿¡æ¯
            };
            //å°†æ•°æ®æ’å…¥åˆ°projectsé›†åˆ
            collection.insert(project,{ 
                safe: true
            }, function (err, project) {
                mongodb.close();
                if (err) {
                    return callback(err);//é”™è¯¯ï¼Œè¿”å›errä¿¡æ¯
                };
                callback(null, project[0]);//æˆåŠŸï¼Œerrä¸ºnullï¼Œå¹¶è¿”å›ç”¨æˆ·å­˜å‚¨åçš„æ–‡æ¡£
            })
        })
    })
}
//è·å–é¡¹ç›®ä¿¡æ¯
Project.get = function(callback) {
<<<<<<< HEAD
    //æ‰“å¼€æ•°æ®åº
=======
    //æ‰“å¼€æ•°æ®åº“
>>>>>>> origin/ç¬¬ä¸‰æ¬¡åˆå¹¶
    mongodb.open(function(err, db) {
        if(err) {
            return callback(err);
        }
        db.collection('projects', function(err, collection) {
            if(err) {
                mongodb.close();//é”™è¯¯ï¼Œå…³é—­æ•°æ®åº“
                return callback(err);//è¿”å›é”™è¯¯ä¿¡æ¯
            }
            collection.find({}).toArray(function(err, docs) {
<<<<<<< HEAD
                mongodb.close();//æŸ¥æ‰¾çš„æ—¶å€™æ•°æ®åº“ä¸å¯¹å¤–å¼€æ”
=======
                mongodb.close();//æŸ¥æ‰¾çš„æ—¶å€™æ•°æ®åº“ä¸å¯¹å¤–å¼€æ”¾
>>>>>>> origin/ç¬¬ä¸‰æ¬¡åˆå¹¶
                if(err) {
                    return callback(err);
                }
                callback(err, docs) //è·å–æˆåŠŸï¼Œè¿”å›é”™è¯¯ä¸ºnullå¹¶ä¸”è¿”å›é›†åˆ
            })
        })
    })
}
//è¯»å–é¡¹ç›®ä¿¡æ¯
Project.get = function(state,callback){
    //æ‰“å¼€æ•°æ®åº
    mongodb.open(function(err,db){
        if(err){
            return callback(err);//é”™è¯¯ï¼Œè¿”å›errä¿¡æ¯
        }
        //è¯»å–projecté›†åˆ
        db.collection('projects',function(err,collection){
            if(err){
                mongodb.close();
                return callback(err);//é”™è¯¯ï¼Œè¿”å›errä¿¡æ¯
            }
            //æŸ¥æ‰¾stateå€¼ä¸º0çš„project
            collection.find({
                state:0
            }).toArray(function(err,projects){
                mongodb.close();
                if(err){
                    return callback(err);//å¤±è´¥ï¼è¿”å›errä¿¡æ¯
                }
                callback(null,projects);//æˆåŠŸã€‚è¿”å›æŸ¥è¯¢åˆ°çš„é¡¹ç›
            });
        });
    });
};
